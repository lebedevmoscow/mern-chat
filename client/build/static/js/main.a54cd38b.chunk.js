(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{107:function(e,t){},111:function(e,t,r){"use strict";r.r(t);var a=r(1),s=r(0),n=r.n(s),o=r(9),c=r.n(o),i=r(17),l=(r(73),r(12)),u="SET_USER_UNREGISTERED",d="SET_USER_REGISTERED",p="SET_USER_TO_LOCALSTORAGE",b=function(){return localStorage.setItem("registered",!0),{type:d}},j=function(e){return localStorage.setItem("user",e),{type:p,payload:e}},h=r(11),m=r.n(h),g=r(19),O="LOAD_USER_DATA",f="LOAD_USER_DATA_SUCCESS",x="LOAD_USER_DATA_FAIL",v="USER_CHOISE_ROOM",y=function(){return function(){var e=Object(g.a)(m.a.mark((function e(t){var r,a,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:O}),r=localStorage.getItem("user"),e.prev=2,e.next=5,fetch("http://localhost:3001/api/user",{method:"POST",headers:{"Content-Type":"application/json","x-auth-token":r}});case 5:return s=e.sent,e.next=8,s.json();case 8:a=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("Cannot fetch user data",e.t0.message||e.t0);case 14:return a.user?t({type:f,payload:a}):t({type:x}),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}()},S=r(3),C=r(125),_=r(126),w=r(14),k=(r(47),r(79),r(4));function N(){return{top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var E=Object(C.a)((function(e){return{paper:{position:"absolute",width:400,backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function I(e){var t=Object(l.c)(),r=E(),o=n.a.useState(N),c=Object(S.a)(o,1)[0],u=n.a.useState(!0),d=Object(S.a)(u,1)[0],p=Object(s.useState)(""),h=Object(S.a)(p,2),x=h[0],v=h[1],y=Object(s.useState)(""),C=Object(S.a)(y,2),I=C[0],T=C[1],R=Object(s.useState)(""),A=Object(S.a)(R,2),D=A[0],P=A[1],U=Object(s.useState)(""),B=Object(S.a)(U,2),L=B[0],H=B[1],q=function(e){switch(e.target.name){case"email":v(e.target.value);break;case"username":T(e.target.value);break;case"password":P(e.target.value);break;case"password2":H(e.target.value);break;default:return}},z=function(){var e=Object(g.a)(m.a.mark((function e(r){var a,s,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),J(D,L)){e.next=3;break}return e.abrupt("return",w.b.error("Repeated password are incorrect",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 3:if(x.match(/^[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[A-Za-z]+$/)){e.next=5;break}return e.abrupt("return",w.b.error("Invalid email",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 5:return a={email:x,password:D,username:I},e.next=8,fetch("http://localhost:3001/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 8:return s=e.sent,e.next=11,s.json();case 11:if("200"!==(s=e.sent).status.toString()){e.next=19;break}return t(b()),t(j(s.token)),n={user:s.user},t({type:O}),t({type:f,payload:n}),e.abrupt("return",w.b.success(s.msg,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 19:if("409"!==s.status.toString()){e.next=21;break}return e.abrupt("return",w.b.error(s.msg,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 21:if("400"!==s.status.toString()){e.next=23;break}return e.abrupt("return",s.errors.map((function(e){return w.b.error(e,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})})));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e,t){return e===t},Z=Object(a.jsxs)("div",{style:c,className:"".concat(r.paper," registermodal__modal"),children:[Object(a.jsx)("h2",{id:"simple-modal-title",children:"For chatting you have to register"}),Object(a.jsx)("small",{children:"Don't worry, it won't takes so much time"}),Object(a.jsx)("h3",{children:"Please fill the form to register"}),Object(a.jsxs)("form",{className:"registermodal__form",children:[Object(a.jsx)("input",{type:"email",placeholder:"type email",name:"email",value:x,required:!0,onChange:q}),Object(a.jsx)("input",{type:"username",placeholder:"type user name",name:"username",value:I,required:!0,onChange:q}),Object(a.jsx)("input",{type:"password",placeholder:"type password",name:"password",value:D,required:!0,autoComplete:"on",onChange:q}),Object(a.jsx)("input",{type:"password",placeholder:"repeat password",name:"password2",value:L,autoComplete:"on",required:!0,onChange:q}),Object(a.jsx)("button",{onClick:z,children:"Submit!"}),Object(a.jsx)("h4",{style:{paddingTop:20},children:"Do you have already account?"}),Object(a.jsx)("button",{style:{marginTop:20},children:Object(a.jsx)(i.b,{to:"/login",children:"Login!"})})]})]});return localStorage.getItem("user")&&localStorage.getItem("registered")?(console.log("redirect"),Object(a.jsx)(k.a,{to:"/"})):Object(a.jsxs)("div",{children:[Object(a.jsx)(_.a,{open:d,"aria-labelledby":"simple-modal-title","aria-describedby":"simple-modal-description",children:Z}),Object(a.jsx)(w.a,{})]})}r(81);var T,R=Object(l.b)(null,{loadUserData:y,changeUserRoom:function(e){return function(){var t=Object(g.a)(m.a.mark((function t(r){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=localStorage.getItem("user"),t.prev=1,t.next=4,fetch("http://localhost:3001/api/user/changeroom",{headers:{"Content-Type":"application/json","x-auth-token":a},method:"POST",body:JSON.stringify({room:e})});case 4:return console.log("change room"),t.abrupt("return",r({type:v,payload:e}));case 8:t.prev=8,t.t0=t.catch(1),console.log("Cannot Update User Room",t.t0.message||t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()}})((function(e){var t=e.changeUserRoom,r=Object(l.d)((function(e){return e.user})),n=Object(s.useState)(1),o=Object(S.a)(n,2),c=o[0],i=o[1],u=Object(s.useState)(null),d=Object(S.a)(u,2),p=d[0],b=d[1],j=Object(s.useState)(null),h=Object(S.a)(j,2),O=h[0],f=h[1];if(Object(s.useEffect)((function(){r.username||y()}),[r]),r.loading)return Object(a.jsx)("h1",{children:"Loading..."});var x=function(){var e=Object(g.a)(m.a.mark((function e(r){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t(c);case 3:b(!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return localStorage.getItem("user")||localStorage.getItem("registered")?p?(console.log("redirect"),Object(a.jsx)(k.a,{to:"/chat"})):O?Object(a.jsx)(k.a,{to:"/"}):Object(a.jsxs)("div",{className:"join-container",children:[Object(a.jsx)("header",{className:"join-header",children:Object(a.jsxs)("h1",{children:[Object(a.jsx)("i",{className:"fas fa-smile"})," Chat by Boris Lebedev"]})}),Object(a.jsx)("main",{className:"join-main",children:Object(a.jsxs)("form",{action:"chat.html",children:[Object(a.jsx)("div",{className:"form-control",children:Object(a.jsxs)("h1",{children:["Welcome, ",r.username]})}),Object(a.jsxs)("div",{className:"form-control",children:[Object(a.jsx)("label",{children:"Choise room where you want to join"}),Object(a.jsxs)("select",{name:"room",id:"room",onChange:function(e){var t=parseInt(e.target.value,10);i(t)},children:[Object(a.jsx)("option",{value:"1",children:"1"}),Object(a.jsx)("option",{value:"2",children:"2"})]})]}),Object(a.jsx)("button",{className:"btn",onClick:x,children:"Join the chat"}),Object(a.jsx)("button",{className:"btn",onClick:function(e){e.preventDefault(),localStorage.removeItem("registered"),localStorage.removeItem("user"),f(!0)},children:"Sign Out"})]})})]}):Object(a.jsx)(k.a,{to:"/register"})})),A=r(8),D=r(61),P=r.n(D),U=r(127),B=function(){return Object(U.a)()},L=r(62),H=r.n(L);T?console.log("dadada"):console.log("netnetnet");var q=function(){var e=Object(s.useState)(""),t=Object(S.a)(e,2),r=t[0],n=t[1],o=Object(s.useState)({message:[],user:[],time:[]}),c=Object(S.a)(o,2),u=c[0],d=c[1],p=Object(s.useState)([]),b=Object(S.a)(p,2),j=b[0],h=b[1],m=Object(s.useRef)(null),g=Object(l.d)((function(e){return e.user}));Object(s.useEffect)((function(){return T=P()("http://localhost:3001"),g.username&&T.emit("user_join_the_chat",{user:g}),T.on("connect_user_client_processed",(function(e){var t=e.user,r=e.listusers;console.log("user",t),console.log("A user",t.username,"connected the chat"),console.log("uesrs",r),h(r[t.room-1])})),T.on("user_send_message_processed",(function(e){var t=e.msg,r=e.time,a=e.username;console.log("msg",t),console.log("time",r),console.log("username",a);var s=Object(A.a)({},u);s.user.push(a),s.time.push(r),s.message.push(t),d(s),console.log("new message: ",t)})),T.on("send_list_of_users",(function(e){h(e)})),T.on("user_disconedted",(function(e){var t=e.chatuser,r=e.listusers;console.log(t,"disconnected"),h(r)})),function(){T.off("connect_user_client_processed"),T.off("user_send_message_processed"),T.off("send_list_of_users"),T.off("user_disconedted")}}),[g]),Object(s.useEffect)((function(){m&&m.current&&m.current.scrollIntoView()}),[u]);return(localStorage.getItem("user")||g.loading)&&g.room?Object(a.jsxs)("div",{className:"chat-container",children:[Object(a.jsxs)("header",{className:"chat-header",children:[Object(a.jsxs)("h1",{children:[Object(a.jsx)("i",{className:"fas fa-smile"})," Chat by Boris Lebedev"]}),Object(a.jsx)("button",{className:"btn",onClick:function(e){e.preventDefault(),T.disconnect()},children:Object(a.jsx)(i.b,{className:"btn",to:"/",children:"Leave Room"})})]}),Object(a.jsxs)("main",{className:"chat-main",children:[Object(a.jsxs)("div",{className:"chat-sidebar",children:[Object(a.jsxs)("h3",{children:[Object(a.jsx)("i",{className:"fas fa-comments"})," Room number:"]}),Object(a.jsx)("h2",{id:"room-name",children:g.room}),Object(a.jsxs)("h3",{children:[Object(a.jsx)("i",{className:"fas fa-users"})," Users"]}),Object(a.jsx)("ul",{id:"users",children:j&&j.map((function(e){var t=B();return Object(a.jsx)("li",{children:e},t)}))})]}),Object(a.jsxs)("div",{className:"chat-messages",children:[u&&u.message&&u.message.map((function(e,t){var r=B();return Object(a.jsxs)("div",{className:"message",children:[Object(a.jsxs)("p",{className:"meta",children:[u.user[t]," - ",u.time[t]]}),Object(a.jsx)("p",{className:"text",children:e})]},r)})),Object(a.jsx)("div",{style:{float:"left",clear:"both",paddingTop:20},ref:m})]})]}),Object(a.jsx)("div",{className:"chat-form-container",children:Object(a.jsxs)("form",{id:"chat-form",children:[Object(a.jsx)("input",{id:"msg",type:"text",placeholder:"Enter Message",value:r,onChange:function(e){return function(e){n(e.target.value)}(e)}}),Object(a.jsxs)("button",{onClick:function(e){e.preventDefault(),n("");var t=H()().format("lll");T.emit("user_send_mesage",{msg:r,time:t,username:g.username}),m.current.scrollIntoView()},className:"btn",children:[Object(a.jsx)("i",{className:"fas fa-paper-plane"})," Send"]})]})})]}):Object(a.jsx)(k.a,{to:"/"})},z=function(){return Object(a.jsx)("div",{children:"404"})};function J(){return{top:"".concat(50,"%"),left:"".concat(50,"%"),transform:"translate(-".concat(50,"%, -").concat(50,"%)")}}var Z=Object(C.a)((function(e){return{paper:{position:"absolute",width:400,backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}}}));function M(e){var t=Object(l.c)(),r=Z(),o=n.a.useState(J),c=Object(S.a)(o,1)[0],u=n.a.useState(!0),d=Object(S.a)(u,1)[0],p=Object(s.useState)(""),h=Object(S.a)(p,2),x=h[0],v=h[1],y=Object(s.useState)(""),C=Object(S.a)(y,2),N=C[0],E=C[1],I=function(e){switch(e.target.name){case"email":v(e.target.value);break;case"password":E(e.target.value);break;default:return}},T=function(){var e=Object(g.a)(m.a.mark((function e(r){var a,s,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),x.match(/^[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[A-Za-z]+$/)){e.next=3;break}return e.abrupt("return",w.b.error("Invalid email",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 3:return a={email:x,password:N},e.next=6,fetch("http://localhost:3001/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 6:return s=e.sent,e.next=9,s.json();case 9:if(s=e.sent,console.log("res",s),"200"!==s.status.toString()){e.next=18;break}return t(b()),t(j(s.token)),n={user:s.user},t({type:O}),t({type:f,payload:n}),e.abrupt("return",w.b.success(s.msg,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 18:if("409"!==s.status.toString()){e.next=20;break}return e.abrupt("return",w.b.error(s.msg,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}));case 20:if("400"!==s.status.toString()){e.next=22;break}return e.abrupt("return",s.errors.map((function(e){return w.b.error(e,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})})));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=Object(a.jsxs)("div",{style:c,className:"".concat(r.paper," registermodal__modal"),children:[Object(a.jsx)("h2",{id:"simple-modal-title",children:"For chatting you have to login"}),Object(a.jsx)("h3",{children:"Please fill to login"}),Object(a.jsxs)("form",{className:"registermodal__form",children:[Object(a.jsx)("input",{type:"email",placeholder:"type email",name:"email",value:x,required:!0,onChange:I}),Object(a.jsx)("input",{type:"password",placeholder:"type password",name:"password",value:N,required:!0,autoComplete:"on",onChange:I}),Object(a.jsx)("button",{onClick:T,children:"Submit!"}),Object(a.jsx)("h4",{style:{paddingTop:20},children:"Do not have already account?"}),Object(a.jsx)("button",{style:{marginTop:20},children:Object(a.jsx)(i.b,{to:"/login",children:"Register!"})})]})]});return localStorage.getItem("user")&&localStorage.getItem("registered")?(console.log("redirect"),Object(a.jsx)(k.a,{to:"/"})):Object(a.jsxs)("div",{children:[Object(a.jsx)(_.a,{open:d,"aria-labelledby":"simple-modal-title","aria-describedby":"simple-modal-description",children:R}),Object(a.jsx)(w.a,{})]})}var F=function(){var e=Object(l.c)();return Object(s.useEffect)((function(){var t=localStorage.getItem("user");t?(e(b()),e(j(t)),e(y())):e((localStorage.removeItem("registered"),{type:u}))}),[e]),Object(a.jsx)("div",{className:"app",children:Object(a.jsxs)(k.d,{children:[Object(a.jsx)(k.b,{exact:!0,path:"/register",component:I}),Object(a.jsx)(k.b,{exact:!0,path:"/login",component:M}),Object(a.jsx)(k.b,{exact:!0,path:"/",component:R}),Object(a.jsx)(k.b,{exact:!0,path:"/chat",component:q}),Object(a.jsx)(k.b,{component:z})]})})},G=r(20),V=r(63),W=r(64),$={registered:!1,user:null},K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d:return Object(A.a)(Object(A.a)({},$),{},{registered:!0});case u:return Object(A.a)(Object(A.a)({},$),{},{user:null,registered:!1});case p:return Object(A.a)(Object(A.a)({},$),{},{user:t.payload,registered:!0});default:return e}},Q={username:null,email:null,hashedPassword:null,loading:!1,error:null,room:null},X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(A.a)(Object(A.a)({},e),{},{loading:!0});case f:return Object(A.a)(Object(A.a)({},e),{},{loading:!1,error:null,email:t.payload.user.email,username:t.payload.user.username,hashedPassword:t.payload.user.password,room:t.payload.user.room});case x:return Object(A.a)(Object(A.a)({},e),{},{loading:!1,error:!0,username:null,hashedPassword:null,room:null});case v:return Object(A.a)(Object(A.a)({},e),{},{room:t.payload});default:return e}},Y=Object(G.combineReducers)({registered:K,user:X}),ee=[W.a],te=Object(G.createStore)(Y,Object(V.composeWithDevTools)(G.applyMiddleware.apply(void 0,ee)));c.a.render(Object(a.jsx)(n.a.StrictMode,{children:Object(a.jsx)(i.a,{children:Object(a.jsx)(l.a,{store:te,children:Object(a.jsx)(F,{})})})}),document.getElementById("root"))},73:function(e,t,r){},79:function(e,t,r){},81:function(e,t,r){}},[[111,1,2]]]);
//# sourceMappingURL=main.a54cd38b.chunk.js.map